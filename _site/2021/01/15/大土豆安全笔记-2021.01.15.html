<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>大土豆安全笔记 2021.01.15 您已本分 | wnagzihxa1n’s blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="大土豆安全笔记 2021.01.15 您已本分" />
<meta name="author" content="wnagzihxa1n" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="先庆祝一下，写了两年公众号，这周关注破四百了，感谢四百零八位读者朋友们的支持，我再努把力，咱们过年前上五百" />
<meta property="og:description" content="先庆祝一下，写了两年公众号，这周关注破四百了，感谢四百零八位读者朋友们的支持，我再努把力，咱们过年前上五百" />
<link rel="canonical" href="http://localhost:4000/2021/01/15/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.15.html" />
<meta property="og:url" content="http://localhost:4000/2021/01/15/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.15.html" />
<meta property="og:site_name" content="wnagzihxa1n’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-15T20:40:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="大土豆安全笔记 2021.01.15 您已本分" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"wnagzihxa1n"},"headline":"大土豆安全笔记 2021.01.15 您已本分","dateModified":"2021-01-15T20:40:00+08:00","@type":"BlogPosting","description":"先庆祝一下，写了两年公众号，这周关注破四百了，感谢四百零八位读者朋友们的支持，我再努把力，咱们过年前上五百","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/01/15/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.15.html"},"datePublished":"2021-01-15T20:40:00+08:00","url":"http://localhost:4000/2021/01/15/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.15.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="wnagzihxa1n's blog" /></head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">wnagzihxa1n&#39;s blog<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/wnagzihxa1n"><i class="fab fa-twitter-square"></i></a><a class="color-purple-hover" href="https://github.com/wnagzihxa1n"><i class="fab fa-github-square"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">
    
    <!-- 
        <img src="/assets/HeadIcon.jpg" class="author-avatar" alt="Avatar" />
     -->
I am wnagzihxa1n, an unknown iOS/Android security researcher, this blog is my security study notes, just share something interesting.

</div>


<div class="post">
  <h1 class="post-title">大土豆安全笔记 2021.01.15 您已本分</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/security_daily/">security_daily</a>
      
  </div>
  
  <div class="post-date">Published on 15 Jan 2021</div>
  
  <p>先庆祝一下，写了两年公众号，这周关注破四百了，感谢四百零八位读者朋友们的支持，我再努把力，咱们过年前上五百</p>

<p>B站还真是一个神奇的网站，啥都能搜到，不过讲的并不是Mach Port很相关的</p>

<p><img src="/assets/resources/2E2BE9F76423A919F796CBBF9497E598.jpg" alt="IMAGE" /></p>

<p>周二发了一篇《<a href="https://mp.weixin.qq.com/s/H3x6mYuXcVge-EKn0gCrmw">CVE-2020-27950 iOS内核信息泄露</a>》，这是近期我一直在学习的漏洞，主要是在Mach Message使用过程中，消息尾部的数据处理没有做好逻辑控制，导致一个字段可以绕过初始化，进而泄露出内核的数据</p>

<p>因为我是刚开始学习，所以有很多基础概念并不清楚，比如Mach Message是什么，Mach Port是什么，还有消息尾trailer，也是在翻了很多纸质资料再结合源码阅读才理解的，关于我看的资料文章里都有记录，包括纸质书籍对应的章节，也都有明确标识</p>

<p>读源码确实可以直观的学到很多，比如用户态数据是如何一层层走到内核态的，XNU的Trap机制，参数命名习惯等等，而且还可以顺带思考下这个漏洞路径周边是否有其它的问题</p>

<p>我还没有研究的很深入，比如Mach Port还要等待接下来仔细学习</p>

<p>本周在看的是玄武实验室发的一篇使用XPC机制提权的漏洞，这样的逻辑漏洞一直是我最喜欢的</p>
<ul>
  <li>https://xlab.tencent.com/en/2021/01/11/cve-2020-9971-abusing-xpc-service-to-elevate-privilege/</li>
</ul>

<p>PJ0的saelo之前分享的launchd漏洞以及2018 pwn2own的利用</p>
<ul>
  <li>https://saelo.github.io/presentations/bits_of_launchd.pdf</li>
</ul>

<p>这两个漏洞我会写比较详细的分析，从XPC开发层面使用，到launchd机制内部实现，在这两部分知识的基础上，再来分析两个漏洞</p>

<p>发现一个很有意思的项目，教大家怎么玩macOS驱动漏洞挖掘利用的，不过作者目前只写了一点，希望别鸽，挺期待的</p>
<ul>
  <li>https://fuzzing.science/vulnerable-kext/about/index.html</li>
</ul>

<p>这两天刷屏了一个病毒《<a href="https://mp.weixin.qq.com/s/J3qblkEvGk-JXFKoIXTVPQ">紧急通知：incaseformat病毒可清空硬盘</a>》，这个病毒属于十多年前的老病毒，多家杀软都支持查杀，大家任选一个即可，这个病毒没啥特别的水平</p>

<p>关于病毒想给大家科普些概念：病毒本质上也是一个软件，背后也是代码</p>

<p>举个安卓病毒例子，我手机上有一款短信软件，有权限发送，接收，删除，编辑等权限，常规来看这种行为是没有问题的，那如果这个软件可以接收服务器的指令去做对应的行为呢？</p>

<p>比如服务器下发一个A指令，这个软件执行代码把短信打包发送回服务器，服务器下发B指令，这个软件就删除所有短信</p>

<p><strong>所有的行为，都是安卓系统本身所允许的操作</strong></p>

<p>高级的病毒，会使用漏洞技术，这些我们暂时不讨论</p>

<p>熊猫正正发了一篇对此事的看法《<a href="https://mp.weixin.qq.com/s/5b7dr_k0gQdWnXPDN9Gxcg">对incaseformat蠕虫事件一些思考</a>》</p>

<p>我以前也是搞APT病毒分析的，我可以理解其中一些观点，现在大家都喜欢吹各种新概念，各种人工智能，机器学习，我也自己跟着学过一些，但毕竟体系庞大而我又很菜，没学会</p>

<p>又到了每周的吃瓜时间，pdd最近很火啊，火出圈了都</p>

<p><img src="/assets/resources/6A75CE1D9F7688B7BBA4886B69293F04.jpg" alt="IMAGE" /></p>

<p>远程删照片事件喜提热搜，这事我从技术角度讲几种可行方案</p>

<p>合理合法不犯罪的第一种：该用户用的是Vivo手机，Vivo是定制的Android系统，Android系统应用使用的是权限申请机制，举个例子，比如某个应用它某个功能需要读写相册，那么它就会申请读写相册的权限，并且需要用户手动点击弹窗的确认按钮，保证用户是知道且同意这个应用申请了读写相册的权限，那么在手机这一侧，pdd已经拥有了读写相册的权限，客户端再跟服务端建立一个指令下发通道，然后就可以跟跟病毒一样下发指令做删除照片的操作了</p>

<p>不合理不合法且犯罪的第二种：使用漏洞</p>

<p>如果是搁平常，我第一反应就是第二种不可能，因为国内Android手机系统版本太多了，首先厂商不同，厂商手机型号不同，还有那些十八线乱七八糟的杂牌，漏洞利用又是比较精细的活，一个字节偏移错了手机都要崩</p>

<p>但pdd现在这情况，我还真不敢说第二种没有可能，pdd的下沉用户到底有多下沉，有多少群体使用的手机系统根本就已经不维护更新了，其它不说，Sqlite，WebView，细思极恐</p>

<p>大牛蛙发的朋友圈，看来脉脉上爆料的拒绝黑客攻击是真的</p>

<p><img src="/assets/resources/AB7A39D6FA52C93725EFF5FB19ABB05C.jpg" alt="IMAGE" /></p>

<p>拼多多的安全大佬发的回忆录，我一直吐槽数字总是搬工位，看来垃圾行政管理哪哪都有，之前有一次搬工位，刚搬了一个月都不到，然后有一个其它部门的HR过来对着我们组的工位说她们要坐这里，我TM</p>
<ul>
  <li>https://www.leadroyal.cn/?p=1228#more-1228</li>
</ul>

<p>本来要收摊了，结果发现一封邮件，我现在是真的不敢去</p>

<p><img src="/assets/resources/5E3BA5D11F9FCF26E14A7451668952C8.jpg" alt="IMAGE" /></p>

<p>最后跟大伙说个事，我建了一个小密圈，不收费，主要是发一些我平时学习的时候读的一些文章</p>

<p>比如今天我要学一个XPC的漏洞，那我就会搜XPC机制是什么，用户态是如何使用的，可控哪些参数，底层如何实现等一堆问题，那就会搜出来很多资料需要看，每周的安全笔记放的都是这些搜索结果筛选过后的资料</p>

<p>所以建个小密圈，我看完的资料，不管有用没用的，都往上放，有兴趣可以加一下，不过别报太大期望，毕竟我只是个入门选手</p>

</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'http://localhost:4000/2021/01/15/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.15.html';
     this.page.identifier = '/2021/01/15/大土豆安全笔记 2021.01.15';
     this.page.title = '大土豆安全笔记 2021.01.15 您已本分';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//wnagzihxa1n-github-io.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/01/22/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.22.html">
            大土豆安全笔记 2021.01.22 在线求团购*OS Internals III
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/01/08/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2021.01.08.html">
            大土豆安全笔记 2021.01.08 我，零基础，学iOS macOS安全
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/12/31/%E5%A4%A7%E5%9C%9F%E8%B1%86%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0-2020.12.31.html">
            大土豆安全笔记 2020.12.31 征途漫漫，惟有奋斗！
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/android_application_security/" class="set-1">android_application_security</a> <a href="/tag/android_ctf/" class="set-3">android_ctf</a> <a href="/tag/browser_security/" class="set-4">browser_security</a> <a href="/tag/security_daily/" class="set-5">security_daily</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
